<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="Michael Lisboa: I'm a UX designer, creative director, illustrator, programmer, start-up founder, and a really good guy who specializes in the creative use of technology to invent and design unforgettable user experiences." name="description"><meta content="user experience, consumer experience, digital strategy, marketing, advertising, programming, python, react" name="keywords"><meta content="width=device-width,initial-scale=1" name="viewport"><title>Michael Lisboa's Portfolio</title><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/safari-pinned-tab.svg" rel="mask-icon" color="#37474f"><meta content="#37474f" name="msapplication-TileColor"><meta content="#37474f" name="theme-color"><meta content="484644278572308" property="fb:app_id"><meta content="https://www.hypermix.com/" property="og:url"><meta content="Michael Lisboa's Portfolio" property="og:title"><meta content="A UX designer, creative director, illustrator, programmer, start-up founder, and a really good guy specializing in the creative use of technology to invent & design unforgettable user experiences." property="og:description"><meta content="website" property="og:type"><meta content="/astro-logo-1200.png" property="og:image"><meta content="Michael Lisboa's Portfolio" property="og:site_name"><meta content="en_US" property="og:locale"><meta content="summary" name="twitter:card"><meta content="@MichaelLisboaCD" name="twitter:site"><meta content="@MichaelLisboaCD" name="twitter:creator"><meta content="https://www.hypermix.com/" name="twitter:url"><meta content="Michael Lisboa's Portfolio" name="twitter:title"><meta content="A UX designer, creative director, illustrator, programmer, start-up founder, and a really good guy specializing in the creative use of technology to invent & design unforgettable user experiences." name="twitter:description"><meta content="/astro-logo-1200.png" name="twitter:image:src"><link href="/favicon.ico" rel="shortcut icon"><link href="/manifest.json" rel="manifest"><link href="https://fonts.googleapis.com/css?family=Roboto:400,600,700,900|Maven+Pro:400,500,600|Bitter:400,700" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.3/css/uikit.min.css" rel="stylesheet"><script src="https://www.google-analytics.com/analytics.js" async></script><script type="text/javascript">!function(i){if(i.search){var l={};i.search.slice(1).split("&").forEach(function(i){var a=i.split("=");l[a[0]]=a.slice(1).join("=").replace(/~and~/g,"&")}),void 0!==l.p&&window.history.replaceState(null,null,i.pathname.slice(0,-1)+(l.p||"")+(l.q?"?"+l.q:"")+i.hash)}}(window.location)</script><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://cdnjs.cloudflare.com" rel="preconnect"><link href="http://cdn.embedly.com" rel="preconnect"><link href="/static/css/main.23f1c8db.chunk.css" rel="stylesheet"><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://cdn.contentful.com" rel="preconnect"><link href="http://images.ctfassets.net" rel="preconnect"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="navbar-container uk-sticky uk-sticky-fixed" style="position:fixed;top:0;width:480px" data-uk-sticky="true"><div class="anim-nav-container uk-hidden@s" style="background:rgba(236,239,241,0);width:80px;height:60px"><div class="uk-padding-small uk-position-fixed" style="margin-top:8px"><span class="uk-float-left uk-icon" data-uk-icon="icon: menu; ratio: 0.9"><svg data-svg="menu" height="18" viewBox="0 0 20 20" width="18" xmlns="http://www.w3.org/2000/svg"><rect height="1" width="16" x="2" y="4"></rect><rect height="1" width="16" x="2" y="9"></rect><rect height="1" width="16" x="2" y="14"></rect></svg></span><small class="uk-float-left uk-text-middle"> MENU</small></div></div><nav class="uk-navbar-container uk-navbar" data-uk-navbar="true"><div class="uk-navbar-center uk-hidden@s"><a href="/" class="uk-navbar-item uk-logo active" aria-current="page"><img alt="Astro Logo" src="/static/media/astro-logo.3658d8d2.svg" data-uk-image="true" width="60px"></a></div><div class="uk-navbar-left uk-margin-medium-left uk-visible@s"><a href="/" class="home-icon uk-link-muted uk-link-reset"><i class="uk-icon" data-uk-icon="icon: arrow-left; ratio: 0.95;"><svg data-svg="arrow-left" height="19" viewBox="0 0 20 20" width="19" xmlns="http://www.w3.org/2000/svg"><polyline points="10 14 5 9.5 10 5" fill="none" stroke="#000"></polyline><line fill="none" stroke="#000" x1="16" x2="5" y1="9.5" y2="9.52"></line></svg></i><i class="uk-icon" data-uk-icon="icon: home; ratio: 0.75;"><svg data-svg="home" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><polygon points="18.65 11.35 10 2.71 1.35 11.35 0.65 10.65 10 1.29 19.35 10.65"></polygon><polygon points="15 4 18 4 18 7 17 7 17 5 15 5"></polygon><polygon points="3 11 4 11 4 18 7 18 7 12 12 12 12 18 16 18 16 11 17 11 17 19 11 19 11 13 8 13 8 19 3 19"></polygon></svg></i></a></div><div class="uk-navbar-center uk-margin-medium-right uk-visible@s"><ul class="uk-navbar-nav"><li><a href="/portfolio"><span class="uk-icon" data-uk-icon="icon: grid; ratio: 0.75"><svg data-svg="grid" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><rect height="3" width="3" x="2" y="2"></rect><rect height="3" width="3" x="8" y="2"></rect><rect height="3" width="3" x="14" y="2"></rect><rect height="3" width="3" x="2" y="8"></rect><rect height="3" width="3" x="8" y="8"></rect><rect height="3" width="3" x="14" y="8"></rect><rect height="3" width="3" x="2" y="14"></rect><rect height="3" width="3" x="8" y="14"></rect><rect height="3" width="3" x="14" y="14"></rect></svg></span> Work</a></li><li><a href="/rates"><span class="uk-icon" data-uk-icon="icon: bolt; ratio: 0.75"><svg data-svg="bolt" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><path d="M4.74,20 L7.73,12 L3,12 L15.43,1 L12.32,9 L17.02,9 L4.74,20 L4.74,20 L4.74,20 Z M9.18,11 L7.1,16.39 L14.47,10 L10.86,10 L12.99,4.67 L5.61,11 L9.18,11 L9.18,11 L9.18,11 Z"></path></svg></span>Rates</a></li><li><a href="/" class="uk-navbar-item uk-logo uk-visible@s active" aria-current="page"><img alt="Astro logo" src="/static/media/astro-logo.3658d8d2.svg" data-uk-image="true" width="55px"></a></li><li><a href="/resume"><span class="uk-icon" data-uk-icon="icon: list; ratio: 0.75"><svg data-svg="list" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><rect height="1" width="12" x="6" y="4"></rect><rect height="1" width="12" x="6" y="9"></rect><rect height="1" width="12" x="6" y="14"></rect><rect height="1" width="2" x="2" y="4"></rect><rect height="1" width="2" x="2" y="9"></rect><rect height="1" width="2" x="2" y="14"></rect></svg></span> Resume</a></li><li><a href="/blog"><span class="uk-icon" data-uk-icon="icon: future; ratio: 0.75"><svg data-svg="future" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><polyline points="19 2 18 2 18 6 14 6 14 7 19 7 19 2"></polyline><path d="M18,6.548 C16.709,3.29 13.354,1 9.6,1 C4.6,1 0.6,5 0.6,10 C0.6,15 4.6,19 9.6,19 C14.6,19 18.6,15 18.6,10" fill="none" stroke="#000" stroke-width="1.1"></path><rect height="7" width="1" x="9" y="4"></rect><path d="M13.018,14.197 L9.445,10.625" fill="none" stroke="#000" stroke-width="1.1"></path></svg></span> Waste</a></li></ul></div></nav></div><div class="uk-sticky-placeholder" style="height:60px;margin:0"></div><main><section class="uk-section uk-article"><div class="uk-container uk-container-small"><p class="uk-text-bold uk-h2 uk-margin-remove-adjacent uk-margin-remove-top">Auto-Generate your Sitemap.xml with Python and deploy it as a Cron job to Google Cloud.</p><p class="uk-article-meta">Posted on January 9, 2019</p><p class="uk-text-lead uk-margin-bottom">A simple python script to automatically generate your sitemap.xml file using Cron on Google Cloud App Engine.</p></div><div class="post-content uk-container uk-container-small"><p>Sitemaps are useful for increasing the effectiveness of your SEO. If you head over to <a href="https://search.google.com/search-console/about" title="Google Search Console">Google's Search Console</a> you'll find a section to upload a file called <code>sitemap.xml</code>.</p><p>There are many ways to create this file, from writing it manually (tedious) to having one of many sites out there index your site and generate the file for you. Either of those options are fine for smaller, static websites, but what if you have a large, high traffic, data driven site with constant updates? Well, then you run into problems :-(</p><p>But the solution is very easy.</p><h4>This example is done in Python, but the idea is the same for any language.</h4><p>First, this is what <code>sitemap.xml</code> looks like.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">?</span>xml version<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'1.0'</span> encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">?</span><span class="token" style="color:#a9b7c6">></span>
<span class="token" style="color:#a9b7c6">&lt;</span>urlset xmlns<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
    xmlns<span class="token" style="color:#a9b7c6">:</span>xsi<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.w3.org/2001/XMLSchema-instance"</span>
    xsi<span class="token" style="color:#a9b7c6">:</span>schemaLocation<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">yoursite</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">1.0</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">yoursite</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span>product<span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">0.8</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">yoursite</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span>product<span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#6897bb">2</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">0.8</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
  
  <span class="token spread" style="color:#a9b7c6">...</span>and so on <span class="token spread" style="color:#a9b7c6">...</span>
<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>urlset<span class="token" style="color:#a9b7c6">></span></code></pre><p>The first part is the XML declaration, which points to the schema on www.sitemaps.org. Following that are the nodes that point to pages on your website. As you can imagine, for large data driven websites with thousands of generated pages, maintaining this file can be really difficult.</p><h5>Let's start coding.</h5><p>Start by opening a new file in your text editor and add this block of code to generate the XML declaration and root <code>&lt;url></code> node:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token module" style="color:#cc7832">import</span> xml<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">etree</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">cElementTree</span> <span class="token module" style="color:#cc7832">as</span> <span class="token" style="color:#9876aa">ET</span>
<span class="token module" style="color:#cc7832">from</span> datetime <span class="token module" style="color:#cc7832">import</span> datetime

def <span class="token" style="color:#ffc66d">generate_sitemap</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span>

    schema_loc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 "</span>
                  <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">)</span>

    root <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">Element</span></span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"urlset"</span><span class="token" style="color:#a9b7c6">)</span>
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns:xsi'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'http://www.w3.org/2001/XMLSchema-instance'</span>
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xsi:schemaLocation'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> schema_loc
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
    
    tree <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">ElementTree</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">)</span>
        tree<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">write</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"sitemap.xml"</span><span class="token" style="color:#a9b7c6">,</span>
                   encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">,</span> xml_declaration<span class="token" style="color:#a9b7c6">=</span><span class="token maybe-class-name">True</span><span class="token" style="color:#a9b7c6">)</span></code></pre><p>We've started by importing <code>xml.etree.cElementTree</code>, a built-in python package for parsing XML. Then we created a function called <code>generate_sitemap()</code>, in which we define XML schema info and the <code>&lt;urlset></code> node.</p><p>At this point, if you were to run this block of code in your Python Console, it would generate a sitemap.xml file in the current directory that looks sort of like this:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">?</span>xml version<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'1.0'</span> encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">?</span><span class="token" style="color:#a9b7c6">></span>
<span class="token" style="color:#a9b7c6">&lt;</span>urlset xmlns<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
    xmlns<span class="token" style="color:#a9b7c6">:</span>xsi<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.w3.org/2001/XMLSchema-instance"</span>
    xsi<span class="token" style="color:#a9b7c6">:</span>schemaLocation<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">></span></code></pre><p>So we're off to a good start! Now under that, we're going to write code to generate our static pages like home page, login, registration, etc.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'>_url <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"https://www.your-website.com/"</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Your</span> website domain<span class="token" style="color:#a9b7c6">.</span>
<span class="token property-access">dt</span> <span class="token" style="color:#a9b7c6">=</span> datetime<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">strftime</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"%Y-%m-%d"</span><span class="token" style="color:#a9b7c6">)</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Get</span> current date and time<span class="token" style="color:#a9b7c6">.</span>

<span class="token property-access">doc</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> _url
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"1.0"</span>

doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span>f<span class="token" style="color:#6a8759">"{_url}login/"</span><span class="token" style="color:#a9b7c6">)</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>

doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}register/"</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
<span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span></code></pre><p>Just a lot of copy/paste going on. Let's break down what's happening here. We've set two variables:</p><ul><li><code>_url</code> is your website root url.</li><li><code>dt</code> is the current date/time formatted as YYYY-MM-DD</li></ul><p>Next we create the <code>&lt;url></code> node as a sub element to the document like this: <code>doc = ET.SubElement(root, "url")</code>. Then we create the <code>&lt;loc></code>, <code>&lt;lastmod></code>, <code>&lt;changefreq></code>, and <code>&lt;priority></code> nodes, which are child nodes of the <code>&lt;url></code> node.</p><p>Just for the sake of clarity, <code>f"{_url}login/"</code> is using string interpolation formatting to create your page URL. In this case, Python will render the string as <code>https://www.your-website.com/login</code>. This save us from having to write out your website URL over and over again.</p><p>If we were to run this code now, it will generate a file that looks like this:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">?</span>xml version<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'1.0'</span> encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">?</span><span class="token" style="color:#a9b7c6">></span>
<span class="token" style="color:#a9b7c6">&lt;</span>urlset xmlns<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
    xmlns<span class="token" style="color:#a9b7c6">:</span>xsi<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.w3.org/2001/XMLSchema-instance"</span>
    xsi<span class="token" style="color:#a9b7c6">:</span>schemaLocation<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">your</span><span class="token" style="color:#a9b7c6">-</span>website<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">1.0</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">your</span><span class="token" style="color:#a9b7c6">-</span>website<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span>login<span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">0.8</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span>url<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>loc<span class="token" style="color:#a9b7c6">></span>https<span class="token" style="color:#a9b7c6">:</span><span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">/</span>www<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">your</span><span class="token" style="color:#a9b7c6">-</span>website<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">com</span><span class="token" style="color:#a9b7c6">/</span>register<span class="token" style="color:#a9b7c6">/</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>loc<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>lastmod<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">2019</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">03</span><span class="token" style="color:#a9b7c6">-</span><span class="token" style="color:#6897bb">29</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>lastmod<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>changefreq<span class="token" style="color:#a9b7c6">></span>weekly<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>changefreq<span class="token" style="color:#a9b7c6">></span>
		<span class="token" style="color:#a9b7c6">&lt;</span>priority<span class="token" style="color:#a9b7c6">></span><span class="token" style="color:#6897bb">0.8</span><span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>priority<span class="token" style="color:#a9b7c6">></span>
	<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>url<span class="token" style="color:#a9b7c6">></span>
<span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">/</span>urlset<span class="token" style="color:#a9b7c6">></span></code></pre><p>Pretty cool, right? But what about all those web pages that are generated by your CMS or database? I mean, we can't possibly copy/paste that much stuff.</p><h5>Querying your database</h5><p>For this part I'm using Django as my frontend to Python. Again, you can use whatever framework or language you want, the idea is still the same. Open your Django app and copy/paste your code into views.py, updating it with the code below.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token module" style="color:#cc7832">import</span> xml<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">etree</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">cElementTree</span> <span class="token module" style="color:#cc7832">as</span> <span class="token" style="color:#9876aa">ET</span>
<span class="token module" style="color:#cc7832">from</span> datetime <span class="token module" style="color:#cc7832">import</span> datetime

<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">http</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">HttpResponse</span> # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">We</span> need <span class="token" style="color:#cc7832">this</span> to <span class="token" style="color:#cc7832">return</span> a response
<span class="token module" style="color:#cc7832">from</span> <span class="token" style="color:#a9b7c6">.</span><span class="token property-access">models</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">MyProductModel</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Import</span> my model


def <span class="token" style="color:#ffc66d">generate_sitemap</span><span class="token" style="color:#a9b7c6">(</span>request<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span>

    _url <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"https://www.your-website.com/"</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Your</span> website domain<span class="token" style="color:#a9b7c6">.</span>
    <span class="token property-access">dt</span> <span class="token" style="color:#a9b7c6">=</span> datetime<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">strftime</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"%Y-%m-%d"</span><span class="token" style="color:#a9b7c6">)</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Get</span> current date and time<span class="token" style="color:#a9b7c6">.</span>

    <span class="token property-access">doc</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> _url
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"1.0"</span>

    doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span>f<span class="token" style="color:#6a8759">"{_url}login/"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>

    doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}register/"</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>
    
    <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d"><span class="token maybe-class-name">HttpResponse</span></span><span class="token" style="color:#a9b7c6">(</span>status<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"200"</span><span class="token" style="color:#a9b7c6">)</span></code></pre><p>We've imported our database model <code>MyProductModel</code>, and since we're using Django, we updated our <code>generate_sitemap</code> function with the <code>request</code> argument and we added an HTTP response.</p><p>In short, we've made our sitemap.xml generator into a web page. I'll explain why further down. But first, let's write the code to generate all of our product pages in the CMS.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'>products <span class="token" style="color:#a9b7c6">=</span> <span class="token maybe-class-name">MyProductModel</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">objects</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">all</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span>

<span class="token" style="color:#cc7832">for</span> product <span class="token" style="color:#cc7832">in</span> products<span class="token" style="color:#a9b7c6">:</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Loop</span> through product queryset
  doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}{product.slug}/"</span>
        <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
        <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
        <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.8"</span></code></pre><p>What we've done here is query our database for all "product" pages with <code>MyProductModel.objects.all()</code>, then loop through the queryset to generate <code>&lt;url></code> nodes for every page. This could be 10 products or 1000 or even more.</p><p>Let's look at our <code>&lt;loc></code> node. We were smart from the beginning when we added products to our system because we added slug fields. So instead of a URL like <code>your-website.com/1028346?sku=28473849/</code> our product page urls are pretty like <code>your-website.com/good-life-product/</code>.</p><p>Anyway, the final code looks like this:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token module" style="color:#cc7832">import</span> xml<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">etree</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">cElementTree</span> <span class="token module" style="color:#cc7832">as</span> <span class="token" style="color:#9876aa">ET</span>
<span class="token module" style="color:#cc7832">from</span> datetime <span class="token module" style="color:#cc7832">import</span> datetime

<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">http</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">HttpResponse</span>
<span class="token module" style="color:#cc7832">from</span> <span class="token" style="color:#a9b7c6">.</span><span class="token property-access">models</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">MyProductModel</span>


def <span class="token" style="color:#ffc66d">generate_sitemap</span><span class="token" style="color:#a9b7c6">(</span>request<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span>

    _url <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"https://www.your-website.com/"</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Your</span> website domain<span class="token" style="color:#a9b7c6">.</span>
    <span class="token property-access">dt</span> <span class="token" style="color:#a9b7c6">=</span> datetime<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">strftime</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"%Y-%m-%d"</span><span class="token" style="color:#a9b7c6">)</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Get</span> current date and time<span class="token" style="color:#a9b7c6">.</span>
    
    <span class="token property-access">schema_loc</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 "</span>
                  <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">)</span>

    root <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">Element</span></span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"urlset"</span><span class="token" style="color:#a9b7c6">)</span>
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns:xsi'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'http://www.w3.org/2001/XMLSchema-instance'</span>
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xsi:schemaLocation'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> schema_loc
    root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>

    doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> _url
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"1.0"</span>

    doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span>f<span class="token" style="color:#6a8759">"{_url}login/"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>

    doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}register/"</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
    <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>
    
    products <span class="token" style="color:#a9b7c6">=</span> <span class="token maybe-class-name">MyProductModel</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">objects</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">all</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span>

    <span class="token" style="color:#cc7832">for</span> product <span class="token" style="color:#cc7832">in</span> products<span class="token" style="color:#a9b7c6">:</span>
      doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
            <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}{product.slug}/"</span>
            <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
            <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
            <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.8"</span>
            
    tree <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">ElementTree</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">)</span>
        tree<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">write</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"sitemap.xml"</span><span class="token" style="color:#a9b7c6">,</span>
                   encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">,</span> xml_declaration<span class="token" style="color:#a9b7c6">=</span><span class="token maybe-class-name">True</span><span class="token" style="color:#a9b7c6">)</span>
    
    <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d"><span class="token maybe-class-name">HttpResponse</span></span><span class="token" style="color:#a9b7c6">(</span>status<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"200"</span><span class="token" style="color:#a9b7c6">)</span></code></pre><h5>Adding the page to your urls.py</h5><p>For Google to read your sitemap it needs to be rendered as a static XML file and available in your root as <code>your-website.com/sitemap.xml</code>. This means we need to add it to our URL patterns as a <code>TemplateView</code> in our urls.py.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'># project<span class="token" style="color:#a9b7c6">/</span>urls<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">py</span>

<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">conf</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">urls</span> <span class="token module" style="color:#cc7832">import</span> url
<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">views</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">generic</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">TemplateView</span>

urlpatterns <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">[</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^sitemap\.xml$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'sitemap.xml'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'text/xml'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
<span class="token" style="color:#a9b7c6">]</span></code></pre><p><code>TemplateView</code> will load sitemap.xml, as a static file, from the root of your templates directory. Remember you need to set the content_type to <code>text/xml</code> if you want the file to render correctly.</p><div><div class="uk-child-width-2-3@s uk-margin-large-top uk-margin-medium-bottom uk-grid uk-grid-stack" uk-grid=""><div class="uk-first-column"><div class="uk-panel uk-background-primary uk-light uk-padding-small uk-border-rounded">On a side note, you can load other static files using `TemplateView`. Here's an example of a boilerplate I use to serve robots.txt, ServiceWorker.js, and manifest.json.</div></div></div></div><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">conf</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">urls</span> <span class="token module" style="color:#cc7832">import</span> url
<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">views</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">generic</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">TemplateView</span>


urlpatterns <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">[</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^manifest\.json$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'manifest.json'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'application/manifest+json'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^ServiceWorker\.js$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'ServiceWorker.js'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'application/javascript'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^robots\.txt$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'robots.txt'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'text/plain'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^sitemap\.xml$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'sitemap.xml'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'text/xml'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
    <span class="token" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>r<span class="token" style="color:#6a8759">'^offline\.html$'</span><span class="token" style="color:#a9b7c6">,</span>
        <span class="token maybe-class-name">TemplateView</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">as_view</span><span class="token" style="color:#a9b7c6">(</span>
            template_name<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'offline.html'</span><span class="token" style="color:#a9b7c6">,</span>
            content_type<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'text/html'</span>
            <span class="token" style="color:#a9b7c6">)</span>
        <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
<span class="token" style="color:#a9b7c6">]</span></code></pre><h5>Google Cloud App Engine & Cron jobs</h5><p>Okay, so we have a url pattern set up to serve our sitemap.xml for search spiders, but how do we generate the file?</p><p>We're going to create a Cron job that automatically runs every couple of weeks, to generate our sitemap.xml, and save it to our templates directory.</p><div><div class="uk-child-width-2-3@s uk-margin-large-top uk-margin-medium-bottom uk-grid uk-grid-stack" uk-grid=""><div class="uk-first-column"><div class="uk-panel uk-background-primary uk-light uk-padding-small uk-border-rounded">I'm not going to go into detail about setting up your project on Google Cloud, that's a whole other story. And again, you could be using another platform like AWS or even hosting yourself, it doesn't matter.</div></div></div></div><p>Let's create a url pattern for our <code>generate_sitemap</code> view and add it to the app urls.py:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'># app<span class="token" style="color:#a9b7c6">/</span>urls<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">py</span>

<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">conf</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">urls</span> <span class="token module" style="color:#cc7832">import</span> url

<span class="token module" style="color:#cc7832">from</span> <span class="token" style="color:#a9b7c6">.</span> <span class="token module" style="color:#cc7832">import</span> views

urlpatterns <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">[</span>

    <span class="token spread" style="color:#a9b7c6">...</span> other url patterns <span class="token spread" style="color:#a9b7c6">...</span>
    
    <span class="token method property-access" style="color:#ffc66d">url</span><span class="token" style="color:#a9b7c6">(</span>
        r<span class="token" style="color:#6a8759">'^generate-sitemap/$'</span><span class="token" style="color:#a9b7c6">,</span>
        views<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">generate_sitemap</span>
    <span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">,</span>
<span class="token" style="color:#a9b7c6">]</span></code></pre><p>Now you should be able to visit <a href="http://localhost:8000/generate-sitemap/">http://localhost:8000/generate-sitemap/</a> and your sitemap function will create the sitemap.xml file in your templates directory.</p><p>Excellent.</p><p>Next, in your project root directory, create a file called <code>cron.yaml</code> then add this:</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'># root<span class="token" style="color:#a9b7c6">/</span>cron<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">yaml</span>

cron<span class="token" style="color:#a9b7c6">:</span>
<span class="token" style="color:#a9b7c6">-</span> description<span class="token" style="color:#a9b7c6">:</span> <span class="token" style="color:#6a8759">"Generate MySitemap CRON"</span>
  url<span class="token" style="color:#a9b7c6">:</span> <span class="token" style="background:#364135"><span class="token regex-delimiter">/</span><span class="token language-regex">generate-sitemap</span><span class="token regex-delimiter">/</span></span>
  schedule<span class="token" style="color:#a9b7c6">:</span> every <span class="token" style="color:#6897bb">14</span> days
  retry_parameters<span class="token" style="color:#a9b7c6">:</span>
    min_backoff_seconds<span class="token" style="color:#a9b7c6">:</span> <span class="token" style="color:#6897bb">120</span>
    max_doublings<span class="token" style="color:#a9b7c6">:</span> <span class="token" style="color:#6897bb">5</span></code></pre><p>This creates a Cron job for App Engine that will visit your generate_sitemap function at <code>www.your-website/generate-sitemap/</code> every 14 days to generate an updated sitemap.xml file and save it to your templates directory so that it's accessible by Google and other search engines.</p><p>Push the Cron job to App Engine with this terminal command:</p><p><code>gcloud app deploy cron.yaml</code></p><p>Then visit your Google Console, under App Engine, you'll see a link for Cron jobs, where you'll find your new "Generate MySitemap CRON" job listed.</p><p><img alt="cron" src="//images.ctfassets.net/1nc0h0ipk4bl/3UnANf5TSGhKxHxwCe4e1i/8ffd2b1f499040d54d5b06ad057119c8/cron.png"></p><p>Okay, you now have a Cron job set up to visit your sitemap generator every 14 days. But, there's a problem...</p><h5>Security?</h5><p>We don't want just anybody to have access, we only want our Cron job to access the function. But then, we can't give the Cron job admin access either.</p><p>So, we're going to use headers to exclude any connections not from our Cron job. This is safe because the <code>x-appengine-cron</code> header is only passed within Google's network, meaning it's unlikely to be spoofed.</p><p>We need to update our view to block everybody except our Cron job.</p><pre style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b'><code style='color:#a9b7c6;font-family:Consolas,Monaco,"Andale Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token module" style="color:#cc7832">import</span> xml<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">etree</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">cElementTree</span> <span class="token module" style="color:#cc7832">as</span> <span class="token" style="color:#9876aa">ET</span>
<span class="token module" style="color:#cc7832">from</span> datetime <span class="token module" style="color:#cc7832">import</span> datetime

<span class="token module" style="color:#cc7832">from</span> django<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">http</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">HttpResponse</span>
<span class="token module" style="color:#cc7832">from</span> <span class="token" style="color:#a9b7c6">.</span><span class="token property-access">models</span> <span class="token module" style="color:#cc7832">import</span> <span class="token maybe-class-name">MyProductModel</span>


def <span class="token" style="color:#ffc66d">generate_sitemap</span><span class="token" style="color:#a9b7c6">(</span>request<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span>

    _url <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"https://www.your-website.com/"</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Your</span> website domain<span class="token" style="color:#a9b7c6">.</span>
    <span class="token property-access">dt</span> <span class="token" style="color:#a9b7c6">=</span> datetime<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">now</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">strftime</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"%Y-%m-%d"</span><span class="token" style="color:#a9b7c6">)</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Get</span> current date and time<span class="token" style="color:#a9b7c6">.</span>
    
    <span class="token property-access">schema_loc</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9 "</span>
                  <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span><span class="token" style="color:#a9b7c6">)</span>
                  
    <span class="token" style="color:#cc7832">if</span> request<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#9876aa">META</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">get</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">'HTTP_X_APPENGINE_CRON'</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">:</span>  #  <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> check <span class="token" style="color:#cc7832">if</span> the x<span class="token" style="color:#a9b7c6">-</span>appengine<span class="token" style="color:#a9b7c6">-</span>cron header exists
      root <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">Element</span></span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"urlset"</span><span class="token" style="color:#a9b7c6">)</span>
      root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns:xsi'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'http://www.w3.org/2001/XMLSchema-instance'</span>
      root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xsi:schemaLocation'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> schema_loc
      root<span class="token" style="color:#a9b7c6">.</span><span class="token property-access">attrib</span><span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6a8759">'xmlns'</span><span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>

      doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> _url
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"1.0"</span>

      doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">(</span>f<span class="token" style="color:#6a8759">"{_url}login/"</span><span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>

      doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}register/"</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
      <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.6"</span>

      products <span class="token" style="color:#a9b7c6">=</span> <span class="token maybe-class-name">MyProductModel</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">objects</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">all</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span>

      <span class="token" style="color:#cc7832">for</span> product <span class="token" style="color:#cc7832">in</span> products<span class="token" style="color:#a9b7c6">:</span>
        doc <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"url"</span><span class="token" style="color:#a9b7c6">)</span>
              <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"loc"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> f<span class="token" style="color:#6a8759">"{_url}{product.slug}/"</span>
              <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"lastmod"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> dt
              <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"changefreq"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">'weekly'</span>
              <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">SubElement</span></span><span class="token" style="color:#a9b7c6">(</span>doc<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">"priority"</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">.</span><span class="token property-access">text</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6a8759">"0.8"</span>

      tree <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#9876aa">ET</span><span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d"><span class="token maybe-class-name">ElementTree</span></span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">)</span>
          tree<span class="token" style="color:#a9b7c6">.</span><span class="token method property-access" style="color:#ffc66d">write</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#6a8759">"sitemap.xml"</span><span class="token" style="color:#a9b7c6">,</span>
                     encoding<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">'utf-8'</span><span class="token" style="color:#a9b7c6">,</span> xml_declaration<span class="token" style="color:#a9b7c6">=</span><span class="token maybe-class-name">True</span><span class="token" style="color:#a9b7c6">)</span>

      <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d"><span class="token maybe-class-name">HttpResponse</span></span><span class="token" style="color:#a9b7c6">(</span>status<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"200"</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#cc7832">else</span><span class="token" style="color:#a9b7c6">:</span>
      <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d"><span class="token maybe-class-name">HttpResponse</span></span><span class="token" style="color:#a9b7c6">(</span>status<span class="token" style="color:#a9b7c6">=</span><span class="token" style="color:#6a8759">"403"</span><span class="token" style="color:#a9b7c6">)</span>  # <span class="token" style="color:#a9b7c6">&lt;</span><span class="token" style="color:#a9b7c6">--</span> <span class="token maybe-class-name">Return</span> <span class="token" style="color:#6a8759">"Not Allowed"</span> <span class="token" style="color:#cc7832">for</span> everybody <span class="token" style="color:#cc7832">else</span><span class="token" style="color:#a9b7c6">.</span></code></pre><p>Now you can deploy your project <code>gcloud app deploy</code> and test your Cron job by clicking the "Run now" button on your Cron page on Google Console.</p><p>And that's it!</p></div></section><footer class="uk-container uk-container-expand uk-margin-remove-top uk-padding-remove uk-light" style="background-color:#37474f"><div class="uk-container uk-container-expand uk-padding-remove uk-margin-remove-vertical"><div class="uk-text-center uk-padding uk-padding-remove-horizontal"><span class="uk-text-small uk-text-light">©2019 Michael Lisboa •  <a href="/contact"><span class="uk-icon" data-uk-icon="icon: mail; ratio: 0.75"><svg data-svg="mail" height="15" viewBox="0 0 20 20" width="15" xmlns="http://www.w3.org/2000/svg"><polyline points="1.4,6.5 10,11 18.6,6.5" fill="none" stroke="#000"></polyline><path d="M 1,4 1,16 19,16 19,4 1,4 Z M 18,15 2,15 2,5 18,5 18,15 Z"></path></svg></span> Contact me</a></span></div></div></footer></main></div><script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.3/js/uikit.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.3/js/uikit-icons.min.js"></script><script src="//cdn.embedly.com/widgets/platform.js" async charset="UTF-8"></script><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={1:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script src="/static/js/2.a083259b.chunk.js"></script><script src="/static/js/main.64b700bf.chunk.js"></script></body></html>