{"componentChunkName":"component---src-templates-blog-detail-js","path":"/blog/suggest-as-you-type-search-widget","result":{"data":{"contentfulBlog":{"id":"f782394a-c6fb-5afc-a8e9-ea8dc322bf7d","imageGallery":null,"date":"2019-02-20","title":"A “suggest-as-you-type” search widget in 57 lines of JavaScript code.","subtitle":{"id":"2276e522-8410-5b77-b078-6ccd468801ba","subtitle":"A how-to for an effective search widget that shows suggestions as you type, in plain JavaScript, and using the Fetch API to GET content."},"slug":"suggest-as-you-type-search-widget","mainImage":{"id":"9b203371-1377-57af-9d16-8541e98a0aa2","file":{"url":"//images.ctfassets.net/1nc0h0ipk4bl/5PWScNM7w6EHCXcGF9schW/ec50ccb8d28975d75379ffd559d56cc2/javascript-suggest-as-you-type.png","fileName":"javascript-suggest-as-you-type.png"}},"content":{"id":"62378bd6-9c5a-54ab-aaeb-b47b6c6d1781","content":"##### While developing Influen$e, I wanted to make the search function a bit more robust for people searching for an influencer's Instagram account by name.\n\nBecause discovery is a critical distinguishing feature of Influen$e, I also wanted to build in a simple recommendation function that targeted customers based on the relevance of influencers' content to their core brand values.\n\nIn this article, I'll share the code and walk you through how the function works.\n\n<section class=\"uk-section uk-section-small\">\n\t<div class=\"content-box uk-container uk-container-small uk-padding-small uk-width-1-2@s\">\n\t\t<h4 class=\"uk-text-center\">Shortcut this</h4>\n\t\t<h5 class=\"uk-text-center\">\n            If you know what you're doing, you can get the code from GitHub.\n        </h5>\n\t\t<div class=\"uk-text-center\">\n\t\t\t<a class=\"uk-button uk-button-large uk-button-secondary\"\n                href=\"https://github.com/MichaelLisboa/suggest-search-vanillaJS\">\n\t\t\t\tGet it on GitHub\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</section>\n\n##### Let's begin\nWe'll start with our search form. It looks like this:\n\n<div class=\"uk-padding uk-padding-remove-horizontal\">\n  <form id=\"SearchMemberForm\" class=\"uk-width-1-3@s\">\n      <div class=\"uk-margin-small\">\n          <div class=\"uk-inline uk-width-1-1\">\n              <button id=\"MemberSubmit\" type=\"submit\" class=\"uk-form-icon uk-form-icon-flip\" uk-icon=\"icon: search\"></button>\n              <input id=\"MemberInput\" type=\"search\" name=\"ig_handle\" class=\"member-search-input uk-input uk-form-large\" placeholder=\"e.g., cristiano\" autocapitalize=\"none\" autocorrect=\"off\" autocomplete=\"off\">\n      </div>\n  </form>\n</div>\n\nI'm using UIKit 3 for my CSS framework, so this part is easy. Here's the code:\n\n        <form id=\"SearchMemberForm\">\n            <div class=\"uk-margin-small\">\n                <div class=\"uk-inline uk-width-1-1\">\n                    <button id=\"MemberSubmit\" type=\"submit\"\n                      class=\"uk-form-icon uk-form-icon-flip\"\n                      uk-icon=\"icon: search\"></button>\n                    <input id=\"MemberInput\" type=\"search\" name=\"ig_handle\"\n                      class=\"member-search-input uk-input uk-form-large\"\n                      placeholder=\"e.g., cristiano\" autocapitalize=\"none\"\n                      autocorrect=\"off\" autocomplete=\"off\" />\n                    <div id=\"PresetMember\" class=\"uk-width-1-1 uk-margin-remove\"\n                      uk-dropdown=\"mode: click; pos: bottom-justify;\n                      boundary: .member-search-input\"></div>\n                </div>\n            </div>\n        </form>        \n\n##### Getting the data with Fetch\nThe first thing we need to do is get an Array of objects to populate suggestions, right? So, we'll make a request to an API or cloud function or whatever.\n\nI'm using Fetch because all I need is a JSON object, but if you want more granular control you can use XHR just the same.\n\n```\nfetch('://<server>/api/', {\n      method: \"GET\",\n      cache: \"no-cache\",\n      credentials: \"same-origin\",\n      headers = {\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json; charset=utf-8\",\n          'X-Requested-With': 'XMLHttpRequest'\n      };\n  })\n  .then(res => res.json())\n  .then(json => {\n      console.log(`JSON response ${json}`)\n  })\n  .catch(error => console.log(error));\n```\n\n__Fetch is pretty straightforward:__\n- I send a `GET` request to my API endpoint at `://<server>/api/`.\n- `.then(res => res.json())` renders the response as JSON.\n- `.then(json => {})` is where we can use that JSON.\n- `.catch(error =>...);` catches any errors in our request.\n\n<div class=\"uk-child-width-2-3@s uk-margin-large-top uk-margin-medium-bottom\" uk-grid>\n  <div>\n    <div class=\"uk-panel uk-background-primary uk-light uk-padding-small uk-border-rounded\">\n      One thing to bear in mind, Fetch doesn't do any error checking, it only returns a fail if something went wrong with the actual request to the server, like a 404 or 500. So, you'll need to write your own error catching code.\n    </div>\n  </div>\n</div>\n\nIf you run that code, you'll get an array of objects. In my case it's an Array of social media influencer objects:\n\n\n![json-response](//images.ctfassets.net/1nc0h0ipk4bl/2L96k8OKFe4cUVSZBzALCD/962961953a3236c6e8446b8363292726/json-response.png)\n\n##### Coding the UI\nNow we need to turn that Array into a nice drop down list. There are two types of lists I'm going to generate.\n- One will be for automated recommendations when the user clicks the search field.\n- The other will be our suggest-as-you-type list.\n\nTo do that, we'll pass our Array to a new function, called `loadLists()`. Let's update our Fetch response to call `loadLists(json)`.\n\n        fetch(endpoint, {\n            method: \"GET\",\n            cache: \"no-cache\",\n            credentials: \"same-origin\",\n            headers: headers,\n        })\n        .then(response => response.json())\n        .then(json => loadLists(json))  // <-- Call loadLists() here\n        .catch(error => console.log(error));\nThis passes our Array of member objects to a new function called `loadLists()`:\n\n        let loadLists = (json) => {\n            let members = [...json.members];\n\n            let searchSuggest = ['input', function(e) {\n                    filterList(event.target.value, members);\n                }, false];\n\n            formInput.addEventListener(...searchSuggest);\n            presetMembers.innerHTML = userList(members.slice(0, 3));\n        }\n\nThere's a couple of things going on here.\n\n- First, we're using a spread operator `[...json.members]` to get to the objects in our array.\n- Next, we're creating an Array called `searchSuggest`, and within calling the `filterList()` function.\n- Then, we add an event listener to the input field in our HTML form.\n- And finally, we're loading the top three recommended influencers into the `presetMembers` drop down menu (I'll get to that soon).\n\nThe reason we created the `searchSuggest` Array is because we want to pass the event and the function call to our event listener. It's just a cleaner way of separating our functions.\n\nOkay, let's have a look at the `filterList();` function.\n\n        let filterList = (key, members) => {\n            let listEl = document.getElementById('MemberList');\n            listEl.innerHTML = '';  // <-- Clear the field to avoid repeated entries.\n\n            for (let i = 0; i < members.length; i++) {\n                if ((members[i].ig_handle.toLowerCase())\n                    .indexOf(key.toLowerCase()) > -1) {\n                    let node = () => (\n                        `<li class=\"member-link\">\n                            ${members[i].ig_handle}\n                        </li>`\n                    );\n                    if (listEl.childNodes.length < 5) {\n                        listEl.insertAdjacentHTML('beforeend', node());\n                    }\n                }\n                if (key.length < 2) {\n                    listEl.innerHTML = '';\n                    presetMembers.innerHTML = userList(members.slice(0, 3));\n                }\n            }\n        };\n\nWow, that's the biggest chunk of code so far. Let's walk through it.\n\nFirst, we're looking at a couple of arguments `key` and `members`. So the argument `members` is obviously our Array of members we got from our Fetch API call.\n\nBut what is `key`?\n\nRemember when we created that Array called `searchSuggest`? Reminder, the event we added is\n\n```\nsearchSuggest = ['input', function(e) {...\n```\n\nWe're adding an event listener for `input`, basically saying for every character the user types into our form field, fire the `input` event. Get it? The `input` event is a keystroke, which is our `key` argument.\n\nIn other words, every time a user types a character into our search field, fire the `filterList()` function.\n\nNext, we're getting the `MemberList` element from our HTML. This is where we'll generate our member list.\n\nLet's take a look at our `for loop`.\n\nIn this line we're converting all text to lowercase so our searches will be case insensitive:\n```\nif ((members[i].ig_handle.toLowerCase()).indexOf(key.toLowerCase()) > -1)\n```\nThen for each character entered, we iterate through our members list and create a new list item node:\n```\nlet node = () => (\n    `<li class=\"member-link\">\n        ${members[i].ig_handle}\n    </li>`\n);\n```\n`${members[i].ig_handle}` is how we're identifying our members. In my case I'm looking them up by the Instagram username `ig_handle`.\n\nThen we get up to five members and add them to our list using `insertAdjacentHTML`:\n```\nif (listEl.childNodes.length < 5) {\n    listEl.insertAdjacentHTML('beforeend', node());\n}\n```\n\nAnd finally, if the user enters less than two characters -- or backspaces to less than two characters -- reload our `presetMembers`, hiding our suggestions:\n```\nif (key.length < 2) {\n    listEl.innerHTML = '';\n    presetMembers.innerHTML = userList(members.slice(0, 3));\n}\n```\n\n##### Stitching it all together\n\nLet get our elements using `getElementById`.\n```\nlet formInput = document.getElementById('MemberInput')  // <-- form <input> field\nlet presetMembers = document.getElementById('PresetMember');  // <-- div for our list\n```\n\nThen we're going to use ES6 template literals to generate our `<ul>` markup that we're inserting into the `presetmember` div.\n\n```\nlet userListItem = (item) => (\n    `<li class=\"uk-width-1-1\">\n        <img class=\"uk-border-circle uk-width-1-4 uk-float-left\" src=\"${item.profile_pic}\" data-uk-image />\n        <p class=\"uk-width-3-4 uk-text-lead uk-text-truncate uk-padding-small uk-padding-remove-vertical\">${item.ig_handle}</p>\n    </li>`\n);\n\nlet userList = (list) => (\n    `<ul id=\"MemberList\" class=\"uk-list uk-list-divider uk-padding-remove-vertical\">\n        ${list.map(userListItem).join('')}\n    </ul>`\n);\n```\n\nSave the file and (hopefully) it should all work beautifully!"}}},"pageContext":{"slug":"suggest-as-you-type-search-widget"}}}